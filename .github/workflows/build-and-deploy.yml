name: Build & Deploy All

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      # 1Ô∏è‚É£ Code auschecken
      - uses: actions/checkout@v4

      # 2Ô∏è‚É£ Node.js einrichten
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      # 3Ô∏è‚É£ Abh√§ngigkeiten installieren
      - name: Install dependencies
        run: npm ci

      # 4Ô∏è‚É£ Build mit Babel
      - name: Build with Babel
        run: |
          echo "üìÅ Vor dem Build:"
          ls -la

          # dist Ordner sauber erstellen
          rm -rf dist
          mkdir -p dist

          echo "üöÄ Starte Babel Build..."
          npx babel scripts --out-dir dist --copy-files --presets @babel/preset-env,@babel/preset-react --verbose

          echo "üìÅ Nach Babel Build:"
          ls -la dist/ || echo "‚ùå dist/ ist leer!"

          # Pr√ºfen auf Komponenten und Utils
          echo "üîç Components Ordner:"
          ls -la dist/components/ 2>/dev/null || echo "‚ùå components/ nicht gefunden!"
          echo "üîç Utils Ordner:"
          ls -la dist/utils/ 2>/dev/null || echo "‚ùå utils/ nicht gefunden!"

          # index.html und styles kopieren
          cp index.html dist/
          cp -r styles/ dist/styles/ 2>/dev/null || echo "‚ö†Ô∏è  styles nicht gefunden"

      # 5Ô∏è‚É£ Deployment auf GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
